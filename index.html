<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>DIGIY DRIVER ‚Äî Chauffeur</title>

<meta name="theme-color" content="#22c55e">
<meta name="description" content="DIGIY DRIVER Chauffeur ‚Äî tableau de bord, courses en temps r√©el, 0% commission.">

<style>
:root{
  --green:#22c55e;
  --green-dark:#16a34a;
  --bg:#f0fdf4;
  --card:#ffffff;
  --text:#0f172a;
  --muted:#64748b;
  --radius:18px;
  --shadow:0 10px 25px rgba(2,6,23,.08);
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
  background:linear-gradient(180deg,#dcfce7 0%,#f0fdf4 60%,#ffffff 100%);
  color:var(--text);
}
header{
  background:linear-gradient(90deg,var(--green),#4ade80);
  color:#fff;
  padding:16px;
  box-shadow:0 8px 20px rgba(34,197,94,.35);
}
.header-inner{
  max-width:980px;
  margin:auto;
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
}
.brand{
  font-weight:900;
  font-size:18px;
}
.pill{
  background:rgba(255,255,255,.25);
  border:1px solid rgba(255,255,255,.35);
  padding:6px 12px;
  border-radius:999px;
  font-size:12px;
  font-weight:800;
}
main{
  max-width:980px;
  margin:auto;
  padding:16px;
}
.card{
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  padding:16px;
  margin-bottom:14px;
}
.row{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:12px;
}
@media(max-width:860px){
  .row{grid-template-columns:1fr}
}
label{
  font-size:12px;
  font-weight:800;
  color:var(--muted);
}
select{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:1px solid rgba(15,23,42,.15);
  font-size:14px;
}
.status{
  display:flex;
  justify-content:space-between;
  align-items:center;
  gap:12px;
  flex-wrap:wrap;
}
.status strong{font-size:15px}
.badge{
  padding:8px 14px;
  border-radius:999px;
  font-weight:900;
  font-size:13px;
  background:#dcfce7;
  color:#14532d;
}
.actions{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
}
button{
  border:none;
  border-radius:14px;
  padding:12px 16px;
  font-weight:900;
  cursor:pointer;
}
.btn-main{
  background:var(--green);
  color:#fff;
}
.btn-light{
  background:#fff;
  border:1px solid rgba(15,23,42,.15);
}
.trip{
  border:1px solid rgba(15,23,42,.1);
  border-radius:16px;
  padding:14px;
  margin-bottom:12px;
}
.trip strong{font-size:15px}
.trip .price{
  color:var(--green-dark);
  font-weight:1000;
  margin-top:6px;
}
.empty{
  text-align:center;
  color:var(--muted);
  padding:24px;
}
</style>
</head>

<body>

<header>
  <div class="header-inner">
    <div class="brand">üöï DIGIY DRIVER</div>
    <div class="pill" id="who">‚Ä¶</div>
  </div>
</header>

<main>

  <!-- Filtres -->
  <div class="card">
    <div class="row">
      <div>
        <label>üìç Zone</label>
        <select id="zoneFilter">
          <option value="">Toutes</option>
          <option>Saly</option>
          <option>Dakar</option>
          <option>Plateau</option>
        </select>
      </div>
      <div>
        <label>üìè Rayon</label>
        <select id="radiusFilter">
          <option value="3">3 km</option>
          <option value="5" selected>5 km</option>
          <option value="10">10 km</option>
        </select>
      </div>
      <div>
        <label>üéõÔ∏è Vue</label>
        <select id="viewFilter">
          <option value="open">Demandes ouvertes</option>
          <option value="mine">Mes courses</option>
          <option value="all">Tout</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Dashboard -->
  <div class="card status">
    <div>
      <strong id="statusTitle">Connexion‚Ä¶</strong><br>
      <span id="statusSub" style="color:var(--muted)">Chargement‚Ä¶</span>
    </div>
    <div class="badge" id="gpsBadge">GPS‚Ä¶</div>
  </div>

  <div class="card status">
    <div>
      <strong>üë§ Mon compte</strong><br>
      <span id="meLine" style="color:var(--muted)">‚Ä¶</span>
    </div>
    <div class="actions">
      <button class="btn-light" id="btnReload">üîÑ Recharger</button>
      <button class="btn-light" id="btnLogout">üö™ D√©connexion</button>
    </div>
  </div>

  <!-- Courses -->
  <div class="card">
    <strong>üö¶ Courses disponibles</strong>
    <div id="trips" style="margin-top:12px"></div>
  </div>

</main>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const SUPABASE_URL = "https://wesqmwjjtsefyjnluosj.supabase.co";
const SUPABASE_ANON_KEY = "COLLE_TON_ANON_KEY_ICI";
const sb = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

const tripsEl = document.getElementById("trips");
const whoEl = document.getElementById("who");
const statusTitle = document.getElementById("statusTitle");
const statusSub = document.getElementById("statusSub");
const gpsBadge = document.getElementById("gpsBadge");
const meLine = document.getElementById("meLine");

/* AUTH + GUARD */
const { data } = await sb.auth.getSession();
const session = data.session;
if(!session){ location.href="redirection.html"; }

const uid = session.user.id;
const { data: profile } = await sb
  .from("profiles")
  .select("role_auto, pro_type")
  .eq("id", uid)
  .single();

if(!profile || profile.pro_type!=="driver"){
  location.href="redirection.html";
}

whoEl.textContent = session.user.phone || session.user.email;
meLine.textContent = `ID ${uid.slice(0,6)}‚Ä¶ ‚Ä¢ Chauffeur personnes`;
statusTitle.textContent = "üü¢ En ligne";
statusSub.textContent = "Pr√™t √† recevoir des courses";

/* GPS */
gpsBadge.textContent = navigator.geolocation ? "GPS OK" : "GPS indisponible";

/* LOAD COURSES (simple placeholder) */
function renderEmpty(){
  tripsEl.innerHTML = `<div class="empty">Aucune course pour l‚Äôinstant.<br>Reste en ligne üöï</div>`;
}
renderEmpty();

/* Actions */
document.getElementById("btnLogout").onclick = async ()=>{
  await sb.auth.signOut();
  location.href="index.html";
};
document.getElementById("btnReload").onclick = ()=>renderEmpty();
</script>

</body>
</html>
